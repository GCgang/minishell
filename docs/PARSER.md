## Parser Flow

### 1. Metacharacter 설정

- 단어를 구분하는 메타문자와 기본 구분자(공백, 줄바꿈, 탭)를 `spe` 집합에 추가합니다.

### 2. 따옴표 확인

- 따옴표(' 또는 ")가 닫혔는지 확인합니다.
  - **닫힘**: 다음 단계로 진행.
  - **닫히지 않음**: `printf: syntax_err`, `exit_status = 2` 설정 후 `main loop`로 복귀합니다.

### 3. 토큰 생성

- 따옴표 기준으로 토큰을 분리하며, 따옴표가 없으면 한 글자씩 분류합니다.
- 특별 문자는 `t`, `$`는 `e`, 그 외는 `w`로 분류됩니다.

### 4. 토큰 합치기

- **Phase 0**: `e + w`, `t + t` 조합으로 토큰을 합칩니다.
- **Phase 1**: `w + w` 조합을 추가로 합칩니다.

#### 세부 규칙:

- **`e + w`**: 따옴표로 구성된 `w`는 합치지 않으며, 환경변수 변환 후에 `w`로 변환되면 Phase 1에서 합칩니다.
- **`t + t`**: `< + <` 또는 `> + >`일 때만 합칩니다.
- **`w + w`**: Phase 1에서 바로 합칩니다.

### 5. 환경 변수 처리

- `Phase 1`로 넘어가기 전에 토큰을 순회하며 heredoc, env, 큰 따옴표 토큰을 분류합니다.
- **heredoc** 뒤에 오는 토큰이 `t`가 아니면 `w`로 취급합니다.

### 6. 환경 변수 검색 및 변환

- 토큰 내부에서 환경 변수를 검색하여 변환합니다.
- `$?`는 `exit_status`로, 리터럴 `$`은 그대로 복사합니다.
- 변환된 값을 토큰에 적용합니다.

### 7. 환경 변수 토큰 다듬기

- `IFS`(Internal Field Separator) 값을 적용하여 토큰을 정리합니다.
  - **기본 IFS**는 공백, 탭, 줄바꿈입니다.
  - 환경 변수 내에서 IFS를 만나면 토큰을 분리합니다.

### 8. 토큰 다듬기

- 공백, 탭, 줄바꿈 등의 구분자 토큰을 제거합니다.
- 연속된 구분자는 모두 제거합니다.

### 9. 연산자 토큰 확인

- 메타문자에서 redirection, pipe 등을 별도로 분류하고, 나머지 메타문자는 `syntax error`로 처리합니다.

### 10. 따옴표 제거

- 각 토큰에서 닫힌 따옴표를 찾아 제거합니다.

### 11. Command 생성

- 파이프를 기준으로 토큰을 `command` 구조체에 저장합니다.
- `word`, `redir` 등으로 구분하여 저장하고, 파이프를 만나면 새로운 `command` 구조체를 생성하여 연결합니다.

---
